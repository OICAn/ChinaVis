<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>ChinaVis 2019</title>
	<link rel="shortcut icon" href="bitbug_favicon.ico" type="image/x-icon" />
	<script type="text/javascript" src="d3.v4.js"></script>
	<script src="https://cdn.staticfile.org/jquery/1.10.2/jquery.min.js"></script>
	<style>
			*{
				padding: 0;
				margin: 0;
			}
			.contain{
				width: 800px;
				height: 1000px;
				position: absolute;
				left: 50%;
				top: 50%;
				margin-left: -400px;
				margin-top: -300px;
				
			}
			.people{
				fill:red;
			}
			.grids2{
				position: absolute;
				top:500px;
			}
			#timeText {
				width: 100px;
				position: absolute;
				top: 50px;
				left: 50%;
				margin-left:-50px;
				text-align: center;
				font-weight: bold;
				font-size: 50px;
			}
			#container{
				margin: 15px auto;
				background: #dcdcdc;
				width: 500px;
				height: 20px;
				border-radius: 3px;
			}
			#control{
				display: inline-block;
				width: 20px;
				height: 28px;
				background: rgb(128,128,128);
				position: relative;
				border-radius: 2px;
				left: 0;
				top: 0;
				margin-top:-4px; 
			}
			.ggrid{
				stroke: gray;
				stroke-width: 2;
			}
			#tooltip {
				position: absolute;
				width: 200px;
				height: auto;
				padding: 10px;
				background-color: white;
				-webkit-border-radius: 10px;
				-moz-border-radius: 10px;
				border-radius: 10px;
				-webkit-box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
				-moz-box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
				box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
				pointer-events: none;
				z-index: 999;
			}
			
			#tooltip.hidden {
				display: none;
			}
			
			#tooltip p {
				margin: 0;
				font-family: sans-serif;
				font-size: 16px;
				line-height: 20px;
			}
		</style>
</head>
<body>
	<div id="tooltip" class="hidden">
			<p id="value"><strong>100</strong></p>
	</div>
	<div id="timeText">
		7:0:0
	</div>
	<div id="container">
		<div id="control"></div>
	</div>
	<svg class="contain"></svg>
	<script type="text/javascript">
		var width = 800,
			height = 1000,
			padding = 50,
			svg,
			day,//存储读取到的day的数据
			people = [],//存储对应时间节点时最新的各个人员的位置
			index = [],//便于快速查找数据
			curr = 0,//便于快速查找数据
			tmpData = d3.range(31),
			tmpData2 = d3.range(17)
			p= 40,//内边距
			xScale= d3.scaleLinear().domain([0, 30]).range([p, width - p]), //(2) 定义x和y比例尺
			gridSize = xScale(1)-xScale(0),
			peopleSize = 5,
			floor1 = [],//第一层的所有人
			floor2 = [];//第二层的所有人
		var	grids1, grids2, bfb, time_min=25200, time_max=68400, now_time, old_time, rScale1, rScale2, area;
		var exits = [{x: 0, y: 19}, {x: 15, y: 5}, {x: 15, y: 15}, {x: 15, y: 17}];
		var son = $("#control");
		var parent = $("#container");

		var grid_SumOfPeople_floor1 = new Array();//存整个楼每个点人数的二维数组，初始化为0
		var grid_SumOfPeople_floor2 = new Array();
		for(var i = 0; i<16; i++){//初始化0
			grid_SumOfPeople_floor1[i] = new Array();
			grid_SumOfPeople_floor2[i] = new Array();
			for(var j = 0; j<30; j++){
				grid_SumOfPeople_floor1[i][j] = 0;
				grid_SumOfPeople_floor2[i][j] = 0;
			}
		}

		//days数据的转换函数
		var rowConventerDay = function (d) {
			return {
				id: parseInt(d.id),
				sid: parseInt(d.sid),
				time: parseInt(d.time),
				x: parseInt(d.x),
				y: parseInt(d.y),
				floor: parseInt(d.floor)
			};
		}
		svg = d3.select("svg");

		//*******
		//main
		//*******
		d3.csv("day1.csv", rowConventerDay, function (dataday) {
			day=dataday;
			old_time = 25200;
			getTimeIn(day, old_time);
			for (var i = 0; i < people.length; i++) {
				var X = people[i].x;
				var Y = people[i].y;
				if(people[i].floor==1){
					floor1.push(people[i]);
					grid_SumOfPeople_floor1[X][Y]++;//二维数组对应++
				}
				else{
					floor2.push(people[i]);
					grid_SumOfPeople_floor2[X][Y]++;
				}
			}
			rScale1 = d3.scaleLinear()
						.domain([leastOfFour(grid_SumOfPeople_floor1), largestOfFour(grid_SumOfPeople_floor1)])
						.range([3, (gridSize-3)/2]);
			rScale2 = d3.scaleLinear()
						.domain([leastOfFour(grid_SumOfPeople_floor2), largestOfFour(grid_SumOfPeople_floor2)])
						.range([3, (gridSize-3)/2]);
			drawGrids();
			draws(floor1, 1);
			draws(floor2, 2);
			drag(son, parent);
		});

		//写给exits数组的函数，用来判断某一坐标是否为出口坐标
		function GetIndex(m,d) {
			for (var i = 0; i < m.length; i++) {
				if(m[i].x==d.x&&m[i].y==d.y)
					return i;
			}
			return -1;
		}
		//整个读取的结构应该是d3.csv(传感器),在这之中根据需要d3.csv(days)
		//参数1是day的数据，二是当前的时间
		//时间递增时的函数，可以动态、快速确定结果
		function getTimeIn(day, time) {
			for (; curr < day.length; curr++) {
				if(day[curr].time<time)
				{
					if(index.indexOf(day[curr].id) == -1)
					{
						index.push(day[curr].id);
						people.push(day[curr]);
					}
					else
					{
						var term = {x: (day[curr].x), y: (day[curr].y)};//判断是否到达出口位置
						if(GetIndex(exits, term)==-1)
						{
							people[index.indexOf(day[curr].id)] = day[curr];
						}
						else//到达出口位置，需要删去该元素
						{
							people.splice(index.indexOf(day[curr].id),1);
							index.splice(index.indexOf(day[curr].id),1);
						}
					}
				}
				else
					break;
			}
		}
		//参数1是day的数据，二是当前的时间
		//时间减少时的函数
		function getTimeDe(day, time) {
			var result=[], indexs = [];
			for (var i = 0; i < day.length; i++) {
				if(day[i].time<time)
				{
					if(indexs.indexOf(day[i].id) == -1)
					{
						indexs.push(day[i].id);
						result.push(day[i]);
					}
					else
					{
						var term = {x: (day[i].x), y: (day[i].y)};//判断是否到达出口位置
						if(GetIndex(exits, term)==-1)
						{
							result[indexs.indexOf(day[i].id)] = day[i];
						}
						else
						{
							result.splice(indexs.indexOf(day[i].id),1);
							indexs.splice(indexs.indexOf(day[i].id),1);
						}
					}
				}
				else
				{
					people = result;
					index = indexs;
					curr = i;
					break;
				}
			}
		}
		function findX(x,floor){
			return xScale(x)+gridSize/2;
		}
		function findY(y,floor){
			if(floor == 1){
				return xScale(y)+gridSize/2;
			}
			else{
				return xScale(16)+xScale(y)+gridSize/2;
			}
		} 	
		function draws(floor, i) {
			if(floor.length>0)
			{
				if(i==1)
				{
					var item = grids1.selectAll("circle")
					.data(floor);

					//update
					item.attr("cx",function (d) {
						return findX(d.y,1);;
					})
	    			.attr("cy",function (d) {
	    				return findY(d.x,1);;
	    			})
	    			.attr("r",function (d) {
	    				return rScale1(grid_SumOfPeople_floor1[d.x][d.y]);
	    			})
	    			.attr("class", "people");

					//enter
					item.enter()
					.append("circle")
					.attr("cx",function (d) {
						return findX(d.y,1);
					})
	    			.attr("cy",function (d) {
	    				return findY(d.x,1);
	    			})
	    			.attr("r",function (d) {
	    				return rScale1(grid_SumOfPeople_floor1[d.x][d.y]);
	    			})
	    			.attr("class", "people");

	    			//exit
	    			item.exit()
	    				.remove();
				}
				else
				{
					//同上
					var item = grids2.selectAll("circle")
					.data(floor);

					//update
					item.attr("cx",function (d) {
						return findX(d.y,2);
					})
	    			.attr("cy",function (d) {
	    				return findY(d.x,2);
	    			})
	    			.attr("r",function (d) {
	    				return rScale2(grid_SumOfPeople_floor2[d.x][d.y]);
	    			})
	    			.attr("class", "people");

					//enter
					item.enter()
					.append("circle")
					.attr("cx",function (d) {
						return findX(d.y,2);
					})
	    			.attr("cy",function (d) {
	    				return findY(d.x,2);
	    			})		
	    			.attr("r",function (d) {
	    				return rScale2(grid_SumOfPeople_floor2[d.x][d.y]);
	    			})
	    			.attr("class", "people");

	    			//exit
	    			item.exit()
	    				.remove();
				}
			}
			else
			{
				if(i==1)
				{
					grids1.selectAll("circle")
					.data(floor)
					.exit()
					.remove();
				}
				else
				{
					grids2.selectAll("circle")
					.data(floor)
					.exit()
					.remove();
				}
			}
			
		}
		function timeFormat(time) {
			var hour = parseInt(time/3600);
			var minute = parseInt((time%3600)/60);
			var second = (time%3600)%60;
			return hour+":"+minute+":"+second;
		}
		//阿春修改
		function drag(obj1,obj3) {//obj1，obj3是jQuery对象。obj1是子元素的jQuery对象，obj3是父元素的jQuery对象。
		    var x;
		    var y;
		    var gapX;
		    var gapY;
		    obj1.mousedown(start);
		    function start(event) {
		        if (event.button == 0) {//判断是否点击鼠标左键
		            gapX = event.clientX - obj1.offset().left + obj3.offset().left;//这是计算在减去鼠标相对于子元素的偏移量后，父元素相对于屏幕的横向距离。
		            gapY = event.clientY - obj1.offset().top + obj3.offset().top;//与gapX同理
		            //movemove事件必须绑定到$(document)上，鼠标移动是在整个屏幕上的
		            $(document).mousemove(move);
		            //此处的$(document)可以改为obj
		            $(document).mouseup(stop);
		        }
		    }
		    function move(event) {
		    	bfb = parseFloat(((obj1.offset().left-obj3.offset().left)/(obj3[0].offsetWidth - obj1[0].offsetWidth)));
		        x = event.clientX - gapX;//用鼠标相对于屏幕的横向距离减去父元素相对于屏幕的横向距离
				if(x < 0) {//限制obj1移出obj3左端
				        x = 0;
				 }
				 //限制obj1移出obj3的右端
				else if(x > (obj3[0].offsetWidth - obj1[0].offsetWidth)) {
				    x = obj3[0].offsetWidth - obj1[0].offsetWidth;
				}
				
				obj1.css({
				    "left": x + "px"
				});
				now_time = parseInt(bfb*(time_max - time_min))+time_min;
				d3.select("#timeText")
					.text(function () {
						return timeFormat(now_time);
					});
		    }
		    function stop(){
		        //解绑定，这一步很必要，前面有解释
		        $(document).unbind("mousemove", move);
		        $(document).unbind("mouseup", stop);
		        if(now_time>old_time)
		        {
		        	old_time = now_time;//更新old_time
		        	getTimeIn(day, now_time);
		        	floor1=[]; floor2=[];

					for(var i = 0; i<16; i++){//重新初始化0
						for(var j = 0; j<30; j++){
							grid_SumOfPeople_floor1[i][j] = 0;
							grid_SumOfPeople_floor2[i][j] = 0;
						}
					}
		        	for (var i = 0; i < people.length; i++) {
						var X = people[i].x;
						var Y = people[i].y;
						if(people[i].floor==1){
							floor1.push(people[i]);
							grid_SumOfPeople_floor1[X][Y]++;//二维数组对应++
						}
						else{
							floor2.push(people[i]);
							grid_SumOfPeople_floor2[X][Y]++;
						}
					}
					rScale1.domain([leastOfFour(grid_SumOfPeople_floor1), largestOfFour(grid_SumOfPeople_floor1)]);
					rScale2.domain([leastOfFour(grid_SumOfPeople_floor2), largestOfFour(grid_SumOfPeople_floor2)]);
					draws(floor1, 1);
					draws(floor2, 2);
					grids1.selectAll(".ggrid")
						.on("mousemove", function(d) {

							//Get this bar's x/y values, then augment for the tooltip
							var xPosition = event.screenX+5;
							var yPosition = event.screenY-150;
							var rect = this.parentNode;// the rectangle, parent of the title

							//Update the tooltip position and value
							d3.select("#tooltip")
								.style("left", xPosition + "px")
								.style("top", yPosition + "px")						
								.select("#value")
								.text(function () {
									return grid_SumOfPeople_floor1[d.x][d.y];
								});
					   
							//Show the tooltip
							d3.select("#tooltip").classed("hidden", false);

					   })
					   .on("mouseout", function() {
					   
							//Hide the tooltip
							d3.select("#tooltip").classed("hidden", true);
							
					   });
					   grids2.selectAll(".ggrid")
						.on("mousemove", function(d) {

							//Get this bar's x/y values, then augment for the tooltip
							var xPosition = event.screenX+5;
							var yPosition = event.screenY-150;
							var rect = this.parentNode;// the rectangle, parent of the title

							//Update the tooltip position and value
							d3.select("#tooltip")
								.style("left", xPosition + "px")
								.style("top", yPosition + "px")						
								.select("#value")
								.text(function () {
									return grid_SumOfPeople_floor2[d.x][d.y];
								});
					   
							//Show the tooltip
							d3.select("#tooltip").classed("hidden", false);

					   })
					   .on("mouseout", function() {
					   
							//Hide the tooltip
							d3.select("#tooltip").classed("hidden", true);
							
					   });
		        }
		        else if(now_time<old_time)
		        {
		        	old_time = now_time;
		        	getTimeDe(day, now_time);
		        	floor1=[]; floor2=[];

					for(var i = 0; i<16; i++){//重新初始化0
						for(var j = 0; j<30; j++){
							grid_SumOfPeople_floor1[i][j] = 0;
							grid_SumOfPeople_floor2[i][j] = 0;
						}
					}
		        	for (var i = 0; i < people.length; i++) {
						var X = people[i].x;
						var Y = people[i].y;
						if(people[i].floor==1){
							floor1.push(people[i]);
							grid_SumOfPeople_floor1[X][Y]++;//二维数组对应++
						}
						else{
							floor2.push(people[i]);
							grid_SumOfPeople_floor2[X][Y]++;
						}
					}
					rScale1.domain([leastOfFour(grid_SumOfPeople_floor1), largestOfFour(grid_SumOfPeople_floor1)]);
					rScale2.domain([leastOfFour(grid_SumOfPeople_floor2), largestOfFour(grid_SumOfPeople_floor2)]);
					draws(floor1, 1);
					draws(floor2, 2);
					grids1.selectAll(".ggrid")
						.on("mousemove", function(d) {

							//Get this bar's x/y values, then augment for the tooltip
							var xPosition = event.screenX+5;
							var yPosition = event.screenY-150;
							var rect = this.parentNode;// the rectangle, parent of the title

							//Update the tooltip position and value
							d3.select("#tooltip")
								.style("left", xPosition + "px")
								.style("top", yPosition + "px")						
								.select("#value")
								.text(function () {
									return grid_SumOfPeople_floor1[d.x][d.y];
								});
					   
							//Show the tooltip
							d3.select("#tooltip").classed("hidden", false);

					   })
					   .on("mouseout", function() {
					   
							//Hide the tooltip
							d3.select("#tooltip").classed("hidden", true);
							
					   });
					   grids2.selectAll(".ggrid")
						.on("mousemove", function(d) {

							//Get this bar's x/y values, then augment for the tooltip
							var xPosition = event.screenX+5;
							var yPosition = event.screenY-150;
							var rect = this.parentNode;// the rectangle, parent of the title

							//Update the tooltip position and value
							d3.select("#tooltip")
								.style("left", xPosition + "px")
								.style("top", yPosition + "px")						
								.select("#value")
								.text(function () {
									return grid_SumOfPeople_floor2[d.x][d.y];
								});
					   
							//Show the tooltip
							d3.select("#tooltip").classed("hidden", false);

					   })
					   .on("mouseout", function() {
					   
							//Hide the tooltip
							d3.select("#tooltip").classed("hidden", true);
							
					   });
		        }
		    }
		}
		function largestOfFour (arr) {
			return d3.max(arr.map(Function.apply.bind(Math.max, null)), function (d) {
				return d;
			});
		}
		function leastOfFour (arr) {
			return d3.min(arr.map(Function.apply.bind(Math.min, null)), function (d) {
				return d;
			});
		}

		function drawGrids() {
			//一楼所有元素
			grids1 = svg.append("g")
							.attr("class", "grids1");
			//一楼灰色区域
			var grayArea1 = grids1.append("g")
							.attr("class", "grayArea1");
			//扶梯
			var futiArea1 = grids1.append("g")
							.attr("class", "futiArea1");
			//各大分会场
			var confA = grids1.append("g")
							.attr("class", "confA");
			var confB = grids1.append("g")
							.attr("class", "confB");
			var confC = grids1.append("g")
							.attr("class", "confC");
			var confD = grids1.append("g")
							.attr("class", "confD");
			//签到处
			var signIn = grids1.append("g")
							.attr("class", "signIn");
			//海报区
			var poster = grids1.append("g")
							.attr("class", "poster");
			//一楼厕所
			var WC1 = grids1.append("g")
							.attr("class", "WC1");
			//服务台
			var service = grids1.append("g")
							.attr("class", "service");
			//一楼room
			var room1 = grids1.append("g")
							.attr("class", "room1");
			var room2 = grids1.append("g")
							.attr("class", "room2");
			var room3 = grids1.append("g")
							.attr("class", "room3");
			var room4 = grids1.append("g")
							.attr("class", "room4");
			//展厅
			var display = grids1.append("g")
							.attr("class", "display");
			//主会场
			var conf = grids1.append("g")
							.attr("class", "conf");
			//出入口
			var exArea = grids1.append("g")
							.attr("class", "exArea");
			//白色区域
			var whiteArea1 = grids1.append("g")
							.attr("class", "whiteArea1");
			//绘制一楼灰色区域##D4D4D4
			var wcgqy=[
			0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,20,21,22,23,24,25,26,27,28,29,
			0,1,2,3,4,5,6,7,8,9,29,
			0,12,13,14,29,
			0,12,13,14,29,
			0,12,13,14,29,
			0,12,13,14,29,
			0,12,13,14,29,
			0,12,13,14,29,
			0,12,13,14,29,
			0,12,13,14,29,
			0,1,2,3,4,5,12,13,14,29,
			0,1,2,3,4,5,12,13,14,29,
			0,29,
			29,
			0,29,
			0,1,3,6,8,9,10,11,12,13,14,16,18,29
			];
			var wcgqx=[
			0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
			1,1,1,1,1,1,1,1,1,1,1,
			2,2,2,2,2,
			3,3,3,3,3,
			4,4,4,4,4,
			5,5,5,5,5,
			6,6,6,6,6,
			7,7,7,7,7,
			8,8,8,8,8,
			9,9,9,9,9,
			10,10,10,10,10,10,10,10,10,10,
			11,11,11,11,11,11,11,11,11,11,
			12,12,
			13,
			14,14,
			15,15,15,15,15,15,15,15,15,15,15,15,15,15
			];
			var currArea=[];
			for (var i = 0; i < wcgqx.length; i++) {
				currArea.push({x: (wcgqx[i]), y: (wcgqy[i])});
			}
			drawItem1(grayArea1, currArea, "#D4D4D4");
			//##000000 扶梯
			currArea=[];
			var futiy=[10,11,10,11];
			var futix=[1,1,14,14];
			for (var i = 0; i < futix.length; i++) {
				currArea.push({x: (futix[i]), y: (futiy[i])});
			}
			drawItem1(futiArea1, currArea, "#000000");
			//##EEEED1 分会场A
			currArea=[];
			for (var i = 2; i < 4; i++) {
				for (var j = 1; j <6 ; j++) {
					currArea.push({x: i, y: j});
				}
			}
			drawItem1(confA, currArea, "#EEEED1");
			//##EEE8AA 分会场B
			for (var i = 0; i < currArea.length; i++) {
				currArea[i].x+=2;
			}
			drawItem1(confB, currArea, "#EEE8AA");
			//##EEE685 分会场C
			for (var i = 0; i < currArea.length; i++) {
				currArea[i].x+=2;
			}
			drawItem1(confC, currArea, "#EEE685")
			//##EEEE00 分会场D
			for (var i = 0; i < currArea.length; i++) {
				currArea[i].x+=2;
			}
			drawItem1(confD, currArea, "#EEEE00");
			//##A52A2A 签到
			currArea=[];
			for (var i = 12; i < 14; i++) {
				for (var j = 2; j < 6; j++) {
					currArea.push({x: i, y: j});
				}
			}
			drawItem1(signIn, currArea, "#A52A2A")
			//海报#E0FFFF
			currArea=[];
			for (var i = 3; i < 11; i++) {
				for (var j = 7; j < 9; j++) {
					currArea.push({x: i, y: j});
				}
			}
			drawItem1(poster, currArea, "#E0FFFF");
			//##CAFF10 展厅
			currArea=[];
			for (var i = 2; i < 12; i++) {
				for (var j = 15; j < 19; j++) {
					currArea.push({x: i, y: j});
				}
			}
			drawItem1(display, currArea, "#CAFF10");
			//##B4EEB4 主会场
			currArea=[];
			for (var i = 2; i < 12; i++) {
				for (var j = 19; j < 29; j++) {
					currArea.push({x: i, y: j});
				}
			}
			drawItem1(conf, currArea, "#B4EEB4");
			//##43CD80 服务台
			currArea=[];
			for (var i = 14; i < 16; i++) {
				for (var j = 19; j < 21; j++) {
					currArea.push({x: i, y: j});
				}
			}
			drawItem1(service, currArea, "#43CD80");
			//##A0522D 厕所
			currArea=[];
			for (var i = 4; i < 6; i++) {
				for (var j = 10; j < 12; j++) {
					currArea.push({x: i, y: j});
				}
			}
			for (var i = 14; i < 16; i++) {
				for (var j = 27; j < 29; j++) {
					currArea.push({x: i, y: j});
				}
			}
			drawItem1(WC1, currArea, "#A0522D");
			//##EEE0E5 room1
			currArea=[];
			for (var i = 6; i < 10; i++) {
				for (var j = 10; j < 12; j++) {
					currArea.push({x: i, y: j});
				}
			}
			drawItem1(room1, currArea, "#EEE0E5");
			//##EED5D2 room2
			currArea=[];
			for (var i = 10; i < 12; i++) {
				for (var j = 10; j < 12; j++) {
					currArea.push({x: i, y: j});
				}
			}
			drawItem1(room2, currArea, "#EED5D2");
			//##EEE0E5 room3
			currArea=[];
			for (var i = 14; i < 16; i++) {
				for (var j = 21; j < 25; j++) {
					currArea.push({x: i, y: j});
				}
			}
			drawItem1(room3, currArea, "#EEE0E5");
			//##EED5D2 room4
			currArea=[];
			for (var i = 14; i < 16; i++) {
				for (var j = 25; j < 27; j++) {
					currArea.push({x: i, y: j});
				}
			}
			drawItem1(room4, currArea, "#EED5D2");
			//##00FA9A 出入口
			currArea=[];
			var cry=[0 ,2 , 4, 5, 7,15,17,19];
			var crx=[13,15,15,15,15,15,15,0 ];
			for (var i = 0; i < crx.length; i++) {
				currArea.push({x: (crx[i]), y: (cry[i])});
			}
			drawItem1(exArea, currArea, "#00FA9A");
			//白色区域FFFFFF
			currArea=[];
			for (var i = 12; i < 29; i++) {
				currArea.push({x: 1, y: i});
			}
			for (var i = 2; i < 15; i++) {
				currArea.push({x: i, y: 6});
			}
			for (var i = 7; i < 9; i++) {
				currArea.push({x: 2, y: i});
			}
			for (var i = 2; i < 15; i++) {
				currArea.push({x: i, y: 9});
			}
			for (var i = 2; i < 4; i++) {
				for (var j = 10; j < 12; j++) {
					currArea.push({x: i, y: j});
				}
			}
			for (var i = 12; i < 15; i++) {
				currArea.push({x: i, y: 1});
			}
			for (var i = 2; i < 6; i++) {
				currArea.push({x: 14, y: i});
			}
			for (var i = 11; i < 15; i++) {
				for (var j = 7; j < 9; j++) {
					currArea.push({x: i, y: j});
				}
			}
			for (var i = 12; i < 14; i++) {
				for (var j = 10; j < 29; j++) {
					currArea.push({x: i, y: j});
				}
			}
			for (var i = 12; i < 19; i++) {
				currArea.push({x: 14, y: i});
			}
			drawItem1(whiteArea1, currArea, "#FFFFFF")

			currArea=[];

			//画二楼了
			//二楼所有元素
			grids2 = svg.append("g")
							.attr("class", "grids2");
			//灰色区域
			var grayArea2 = grids2.append("g")
							.attr("class", "grayArea2");
			//扶梯
			var futiArea2 = grids2.append("g")
							.attr("class", "futiArea2");
			//room区域
			var room2 = grids2.append("g")
							.attr("class", "room2");
			//食堂
			var canteen = grids2.append("g")
							.attr("class", "canteen");
			//休闲区
			var relaxation = grids2.append("g")
							.attr("class", "relaxation");
			//厕所
			var WC2 = grids2.append("g")
							.attr("class", "WC2");
			//白色区域
			var whiteArea2 = grids2.append("g")
							.attr("class", "whiteArea2");

			//二楼灰色区域绘制 ##D4D4D4
			var wcgqy2=[
			0,1,2,3,4,5,6,7,8,9,10,11,
			0,1,2,3,4,5,6,7,8,9,
			0,
			0,
			0,
			0,
			0,
			0,
			0,10,11,
			0,10,11,
			0,10,11,
			0,10,11,
			0,1,2,3,4,5,
			6,7,8,9,10,11
			];
			var wcgqx2=[
			0,0,0,0,0,0,0,0,0,0,0,0,
			1,1,1,1,1,1,1,1,1,1,
			2,
			3,
			4,
			5,
			6,
			7,
			8,8,8,
			9,9,9,
			10,10,10,
			11,11,11,
			12,12,12,12,12,12,
			15,15,15,15,15,15
			];
			for (var i = 0; i < wcgqx2.length; i++) {
				currArea.push({x: (wcgqx2[i]), y: (wcgqy2[i])});
			}
			for (var i = 0; i < 16; i++) {
				for (var j = 12; j < 30; j++) {
					currArea.push({x: i, y: j});
				}
			}
			drawItem2(grayArea2, currArea, "#D4D4D4");
			currArea=[];
			//##000000 扶梯
			var futiy=[10,11,10,11];
			var futix=[1,1,14,14];
			for (var i = 0; i < futix.length; i++) {
				currArea.push({x: (futix[i]), y: (futiy[i])});
			}
			drawItem2(futiArea2, currArea, "#000000");
			currArea=[];
			//##EEE0E5 room2
			for (var i = 10; i < 12; i++) {
				for (var j = 1; j < 6; j++) {
					currArea.push({x: i, y: j});
				}
			}
			for (var i = 6; i < 8; i++) {
				for (var j = 10; j < 12; j++) {
					currArea.push({x: i, y: j});
				}
			}
			drawItem2(room2, currArea, "#EEE0E5");
			currArea=[];
			//##90EE90 餐厅
			for (var i = 2; i < 10; i++) {
				for (var j = 1; j < 6; j++) {
					currArea.push({x: i, y: j});
				}
			}
			drawItem2(canteen, currArea, "#90EE90");
			currArea=[];
			//##D15FEE 休闲区
			for (var i = 13; i < 16; i++) {
				for (var j = 0; j < 6; j++) {
					currArea.push({x: i, y: j});
				}
			}
			drawItem2(relaxation, currArea, "#D15FEE");
			currArea=[];
			//##A0522D 厕所
			for (var i = 4; i < 6; i++) {
				for (var j = 10; j < 12; j++) {
					currArea.push({x: i, y: j});
				}
			}
			drawItem2(WC2, currArea, "#D15FEE");
			//##白色区域FFFFFF
			currArea=[];
			for (var i = 2; i < 15; i++) {
				for (var j = 6; j < 10; j++) {
					currArea.push({x: i, y: j});
				}
			}
			for (var i = 2; i < 4; i++) {
				for (var j = 10; j < 12; j++) {
					currArea.push({x: i, y: j});
				}
			}
			for (var i = 12; i < 14; i++) {
				for (var j = 10; j < 12; j++) {
					currArea.push({x: i, y: j});
				}
			}
			drawItem2(whiteArea2, currArea, "#FFFFFF");
			currArea=[];
		}

			function drawItem1(item, data, color) {
				item.selectAll("rect")
					.data(data)
					.enter()
					.append("rect")
					.attr("x", function (d) {
						return xScale(d.y);
					})
					.attr("y", function (d) {
						return xScale(d.x);
					})
					.attr("width", gridSize)
					.attr("height", gridSize)
					.attr("fill", color)
					.attr("class", "ggrid");
				}
			function drawItem2(item, data, color) {
				item.selectAll("rect")
					.data(data)
					.enter()
					.append("rect")
					.attr("x", function (d) {
						return xScale(d.y);
					})
					.attr("y", function (d) {
						return xScale(d.x)+xScale(16);
					})
					.attr("width", gridSize)
					.attr("height", gridSize)
					.attr("fill", color)
					.attr("class", "ggrid");
				}
	</script>
</body>
</html>
